<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LibreTV 播放器</title>

    <!-- Favicon -->
    <link rel="icon" href="https://images.icon-icons.com/38/PNG/512/retrotv_5520.png">
    <link rel="apple-touch-icon" href="https://images.icon-icons.com/38/PNG/512/retrotv_5520.png">
    <link rel="manifest" href="manifest.json">

    <script src="libs/tailwindcss.min.js"></script>
    <script src="js/wakelock.js"></script>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/player.css">
</head>

<body>
    <header class="bg-[#111] p-4 flex items-center border-b border-[#333] gap-2 player-header">
        <div class="flex items-center min-w-0">
            <a href="/" class="flex items-center min-w-0">
                <svg class="w-8 h-8 mr-2 text-[#00ccff] logo-icon" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z">
                    </path>
                </svg>
                <h1 class="text-xl font-bold gradient-text logo-text">LibreTV</h1>
            </a>
        </div>
        <h2 id="videoTitle"
            class="text-xl font-semibold flex-1 text-center overflow-x-auto whitespace-nowrap truncate custom-title-scroll">
        </h2>
        <button onclick="goBack()"
            class="px-4 py-2 bg-[#222] hover:bg-[#333] border border-[#333] rounded-lg transition-colors flex items-center min-w-0 back-btn">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-1" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 19l-7-7 7-7"></path>
            </svg>
            <!-- <span class="back-btn-text">返回上页</span> -->
        </button>
    </header>

    <main class="container mx-auto px-4 py-4">
        <!-- 视频播放区 -->
        <div id="playerContainer" class="player-container">
            <div class="relative">
                <div id="player"></div>
                <div class="loading-container" id="loading">
                    <div class="loading-spinner"></div>
                    <div>正在加载视频...</div>
                </div>
                <div class="error-container" id="error">
                    <div class="error-icon">⚠️</div>
                    <div id="error-message">视频加载失败</div>
                    <div style="margin-top: 10px; font-size: 14px; color: #aaa;">请尝试其他视频源或稍后重试</div>
                </div>
            </div>
        </div>

        <!-- 添加自动播放开关、播放控制按钮和功能按钮 -->
        <div class="player-container mb-2"  style="margin-top: 12px;">
            <div class="flex items-center justify-between relative button-layout">
                <!-- 左侧按钮组：集数网格切换和排序一体化按钮 -->
                <div class="flex items-center gap-2 left-buttons">
                    <!-- 集数网格切换和排序一体化按钮 -->
                    <button id="episodesToggle" onclick="toggleEpisodesGridAndOrder()"
                        class="p-2 bg-[#222] hover:bg-[#333] border border-[#333] rounded-lg transition-colors flex items-center justify-center gap-2"
                        title="显示/隐藏集数网格，点击箭头切换排序">
                        <!-- 网格图标 -->
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                        </svg>
                        <!-- 排序箭头 -->
                        <svg class="w-4 h-4 episode-order-arrow cursor-pointer hover:scale-110 transition-transform" 
                             fill="none" stroke="currentColor" viewBox="0 0 24 24"
                             onclick="toggleEpisodeOrder(event)">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                d="M7 14l5-5 5 5"></path>
                        </svg>
                    </button>
                </div>

                <!-- 中间播放控制按钮组 -->
                <div class="flex items-center gap-2 center-buttons">
                    <!-- 上一集按钮 -->
                    <button onclick="playPreviousEpisode()" id="prevButton"
                        class="p-2 bg-[#222] hover:bg-[#333] border border-[#333] rounded-lg transition-colors flex items-center justify-center"
                        title="上一集">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
                            </path>
                        </svg>
                    </button>

                    <!-- 暂停/播放按钮 -->
                    <button onclick="togglePlayPause()" id="playPauseButton"
                        class="p-2 bg-[#00ccff] hover:bg-[#00aacc] border border-[#00ccff] rounded-lg transition-colors flex items-center justify-center"
                        title="暂停/播放">
                        <svg id="playPauseIcon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"></path>
                        </svg>
                    </button>

                    <!-- 下一集按钮 -->
                    <button onclick="playNextEpisode()" id="nextButton"
                        class="p-2 bg-[#222] hover:bg-[#333] border border-[#333] rounded-lg transition-colors flex items-center justify-center"
                        title="下一集">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                            </path>
                        </svg>
                    </button>
                </div>

                <!-- 右侧功能按钮组 -->
                <div class="flex items-center gap-2 right-buttons">
                    <!-- 收藏按钮 -->
                    <button id="favoriteToggle" onclick="toggleFavorite()" title="收藏/取消收藏"
                        class="p-2 bg-[#222] hover:bg-[#333] border border-[#333] text-white rounded-lg transition-colors flex items-center justify-center">
                        <svg id="favoriteIcon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <!-- 默认状态：未收藏（空心五角星） -->
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.562.562 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.562.562 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                        </svg>
                    </button>

                    <!-- 锁定控制按钮 -->
                    <button id="lockToggle" onclick="toggleControlsLock()" title="锁定控制"
                        class="p-2 bg-[#222] hover:bg-[#333] border border-[#333] text-white rounded-lg transition-colors flex items-center justify-center">
                        <svg id="lockIcon" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <!-- 默认状态：未锁图标 -->
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 11V7a3 3 0 00-6 0v4m-3 4h12v6H6v-6z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- 集数网格 - 默认隐藏 -->
        <div class="player-container hidden" id="episodesGrid"  style="margin-top: 12px;">
            <div class="episode-grid">
                <div id="episodesList">
                    <!-- 集数将在这里动态加载 -->
                    <div class="text-center text-gray-400 py-8">加载中...</div>
                </div>
            </div>
        </div>
    </main>

    <!-- 添加快捷键提示元素 -->
    <div class="shortcut-hint" id="shortcutHint">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="shortcutIcon">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        <span id="shortcutText"></span>
    </div>



    <!-- 引入认证系统 -->
    <script src="js/auth-system.js"></script>
    <script src="js/api.js"></script>
    <script src="libs/hls.min.js" crossorigin="anonymous"></script>
    <script src="libs/DPlayer.min.js" crossorigin="anonymous"></script>

    <script src="js/config.js"></script>
    <script src="js/hls-cache.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/tool.js"></script>
    <script src="js/player.js"></script>

    <script>
        // 回退功能
        function goBack() {
            if (document.referrer && document.referrer !== window.location.href) {
                // 如果有来源页面且不是当前页面，则回退
                window.history.back();
            } else {
                // 如果没有来源页面或来源是当前页面，则跳转到首页
                window.location.href = '/';
            }
        }
    </script>
</body>

</html>